\documentclass[a4paper,10pt]{article}

\usepackage{amsmath}
\usepackage{amssymb}

\begin{document}
\title{Solving Templates in Function Postcondition}
%\author{Ravichandhran Kandhadai Madhavan \\ ravi.kandhadai@epfl.ch}
\maketitle

%\newcommand{\dash}[1]{\overline{#1}}
%\newcommand{\progst}[1]{\texttt{#1}}
%\newcommand{\temp}{\mathit{\phi_{temp}}}
%\newcommand{\post}{\mathit{\phi_{post}}}
%\newcommand{\body}{\mathit{\phi_{body}}}
%\newcommand{\zerovec}{\mathbf{0}}
%\newcommand{\Body}[1]{\mathit{Body(#1)}}
%\newcommand{\Post}[1]{\mathit{Post(#1)}}
%\newcommand{\Temp}[1]{\mathit{Temp(#1)}}
\newcommand{\imp}{\Rightarrow}
\newcommand{\biimp}{\Leftrightarrow}
\newcommand{\vbar}{\; | \;}


\begin{align*}
& \exists a,b. \quad \forall t,res,x1,v,l,r,s,hlp,tp,rh.\\
& hlp(t) \wedge ((t=Leaf() \wedge res=0) \vee \\
& \qquad (t=Node(x1,v, l, r) \wedge res=s(l)+s(r)+1 \wedge tp(rh(l)) \le a*s(l) + b \wedge tp(rh(r)) \le a*s(r)+b)) \\
& \imp tp(rh(t)) \le a*res + b) \\ \\
& hlp(t) \wedge ((t=Leaf() \wedge res=0) \vee \\
& (t=Node(x1,v, l, r) \wedge res=s(l)+s(r)+1 \wedge tp(rh(l)) \le a*s(l) + b \wedge tp(rh(r)) \le a*s(r)+b)) \\
& \wedge tp(rh(t)) > a*res + b \imp false
\end{align*}
%
\begin{align*}
& hlp(t) \wedge hlp(t) \biimp (hlp(l) \wedge hlp(r) \wedge rh(l) \ge rh(r) \wedge \ldots) \\ 
& \wedge ((t=Leaf() \wedge res=0) \vee (t=Node(x1,v, l, r) \wedge res=s(l)+s(r)+1 \wedge \\
& tp(rh(l)) \le a*s(l) + b \wedge tp(rh(r)) \le a*s(r)+b \wedge s(l)=\cdots \wedge s(r)=\cdots)  \\
& \wedge tp(rh(t))>a*res + b \wedge rh(t)=rh(r)+1 \wedge tp(rh(t)) = 2*tp(rh(t)-1) \imp false  \\
\end{align*}

When a=1 and b=1 the above implication holds. Proof: (when $t$ is not a $Leaf$)
%
\begin{align*}
& rh(l) \ge rh(r) \imp tp(rh(l)) \ge tp(rh(r)) & \cdots \text{ (monotonicity) } \\ 
& tp(rh(r)) \le a*s(l) + b \wedge tp(rh(r)) \le a*s(r)+b \\
& 2*tp(rh(r)) \le a*(s(l) + s(r)) + b \\
& 2*tp(rh(t)-1) \le a*(res - 1) + b \\
& tp(rh(t)) \le a*res - a + b \\
& \exists a,b. \quad \forall tp,rh,t,res. \qquad tp(rh(t)) \le a*res - a + b \wedge tp(rh(t))>a*res + b \imp false \\
& tp(rh(t)) \le res \wedge tp(rh(t))>res + 1 \imp false \\
\end{align*}

Solving numerical $\exists \forall$ formulas can be done using Farkas' Lemma, CEGIS etc.
\end{document}