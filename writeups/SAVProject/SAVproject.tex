\documentclass[a4paper,10pt]{article}
\begin{document}
\title{SAV project proposal \\ Templates in Function Postconditions}
\author{Ravichandhran Kandhadai Madhavan}
\maketitle

\newcommand{\dash}[1]{\overline{#1}}

\section{Problem Definition}

The goal of the project is to (a) enable the use of (quantifier-free) linear templates with unknown coefficients in the postconditions and (b) to develop an inference engine for finding an instantiation of the linear template that is inductive. In this project, the focus is only on Leon programs that can be expressed as linear transition systems. In such programs every primitive expression is a linear combination of program variables and function invocations. However, the programs may have \textit{if-then-else} constructs and \textit{let} constructs. Also, every expression in the program is of type \textit{Int}.
%The freedom to specify such templates in post-conditions will greatly reduce the annotation burden of the programmer.
The templates in the postconditions can use the parameters, the result variable and also user-defined functions. Formally, a template is an expression of the form $a_0 + a_1x_1 + \cdots + a_{k-1}x_{k-1} + a_kf_k(\bar{a}_k) + \cdots + a_nf_n(\bar{a}_n) \; op \; 0$ where $op \in \{\le, =, \ne \}$, each $x_i$ is a program variable, each $f_i$ is a user-defined function symbol, each $a_i$ is a constant or a unknown coefficient (referred to as a \textit{template variable}) and each $\bar{a}_i$ is a set of template variables.

\section{The Approach}

\cite{ssriram:CAV03,ssriram:SAS04} proposes an approach based on constraint solving for inferring  inductive invariants that are instantiations of a predefined linear template. This approach can be adapted to construct the inference engine required by the project. Consider a function (belonging to the above restricted language) whose postcondition uses templates. Assume that the postcondition is a single atomic predicate. The verification condition computed by Leon for the function would be of the form: $\varphi: \bigwedge_i \varphi_i$, where,
$\mathit{\varphi_i: } \forall \dash{x}. \phi[\dash{x},\dash{a}] \Rightarrow p[\dash{x},\dash{a}]$, $\dash{x}$ is a set of program variables, $\dash{a}$ is a set of template variables, $\phi$ is a conjunction of linear atomic predicates defined over the program and template variables and $p$ is a single atomic predicate.
The goal is to find an assignment to $\dash{a}$ such that $\varphi$ holds.
As described in \cite{ssriram:CAV03}, by \textit{Farka's Lemma}, the values of $\dash{a}$ that satisfy $\varphi$ can be obtained by solving a system of non-linear real valued inequalities generated from $\varphi$. To solve the inequalities, the plan is to use the Z3 SMT solver integrated into Leon.

Allowing conjunctions in the postcondition is straight-forward as the generated  verification condition can be translated to the  form given by $\varphi$. However, supporting disjunctions in the postcondition is challenging as the verification condition generated by Leon cannot be directly reduced to the form given by $\varphi$. In such cases, the plan is to construct a formulae of the required form that is stronger than the verification condition. A solution for the stronger formulae is also a solution 
for the original verification condition.

In addition to implementing the above approach, I plan to extend it to handle templates with user-defined functions using the ideas presented in \cite{dirk:VMCAI07}. I also plan to combine this approach with the function unrolling mechanism of Leon to discover invariants that requires reasoning about multiple procedures.
 
\section{Completeness of the approach}

There are two sources of incompleteness: (a) Farka's Lemma is incomplete for integer arithmetic. There exists instantiations of templates that are inductive but cannot be found by the proposed approach. (b) Handling of disjunctions in the postconditions also introduces incompleteness.
As a part of the project I propose to study and characterize formulas (of the form given by $\varphi$) for which Farka's Lemma may be incomplete.

\section{Deliverables}

An enhanced Leon verifier that can support linear templates in postconditions. Ideally, it should be able to handle all linear transition systems when expressed as Leon programs.

\bibliographystyle{acm}
\bibliography{SAVproject}

\end{document}